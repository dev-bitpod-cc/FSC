# è£ç½°æ¡ˆä»¶è³‡æ–™çµæ§‹è¨­è¨ˆ

## ğŸ“Š æ¢ç´¢ç™¼ç¾

æ ¹æ“š `scripts/explore_penalties.py` çš„æ¢ç´¢çµæœï¼š

### åˆ—è¡¨é çµæ§‹
- **HTML çµæ§‹**: èˆ‡å…¬å‘Šç›¸åŒï¼Œä½¿ç”¨ `<li role="row">`
- **æ¬„ä½**: ç·¨è™Ÿã€è£è™•æ›¸ç™¼æ–‡æ—¥æœŸã€è³‡æ–™ä¾†æºã€æ¨™é¡Œ
- **åˆ†é **: POST è¡¨å–®ï¼ŒJavaScript `list(page)` å‡½æ•¸
- **ç¸½æ•¸**: å…± 42 é ï¼Œç´„ 630 ç­†è£ç½°æ¡ˆä»¶

### è©³ç´°é çµæ§‹
- **å…§å®¹å€åŸŸ**: `div.content`
- **é™„ä»¶**: æœ‰ PDF è£è™•æ›¸
- **çµæ§‹åŒ–è³‡æ–™**:
  - ç™¼æ–‡å­—è™Ÿï¼šé‡‘ç®¡ä¿å£½å­—ç¬¬11404937382è™Ÿ
  - ç™¼æ–‡æ—¥æœŸï¼šä¸­è¯æ°‘åœ‹114å¹´9æœˆ25æ—¥
  - è¢«è™•åˆ†äººï¼šå…¨çƒäººå£½ä¿éšªè‚¡ä»½æœ‰é™å…¬å¸
  - è™•åˆ†é‡‘é¡ï¼šæ–°è‡ºå¹£300è¬å…ƒ
  - é•è¦äº‹å¯¦ï¼šå…§æ§ç¨‹åºç¼ºå¤±...
  - æ³•æ¢ä¾æ“šï¼šä¿éšªæ³•ç¬¬171æ¢ä¹‹1ç¬¬4é …

---

## ğŸ¯ è³‡æ–™çµæ§‹è¨­è¨ˆ

### 1. JSONL åŸå§‹è³‡æ–™æ ¼å¼

```json
{
  "id": "fsc_pen_20250925_0001",
  "data_type": "penalty",
  "page": 1,
  "list_index": "1",
  "date": "2025-09-25",
  "source_raw": "ä¿éšªå±€",
  "title": "å…¨çƒäººå£½ä¿éšªè‚¡ä»½æœ‰é™å…¬å¸è¾¦ç†ä¸€èˆ¬æ¥­å‹™æª¢æŸ¥å ±å‘Šï¼ˆç·¨è™Ÿï¼š112I018ï¼‰æ‰€åˆ—......",
  "detail_url": "https://www.fsc.gov.tw/ch/home.jsp?id=131&parentpath=0,2&mcustomize=multimessage_view.jsp&dataserno=202509300001&dtable=Penalty",
  "list_url": "https://www.fsc.gov.tw/ch/home.jsp",
  "content": {
    "text": "é‡‘èç›£ç£ç®¡ç†å§”å“¡æœƒã€€è£è™•æ›¸\nå—æ–‡è€…ï¼šå¦‚æ­£å‰¯æœ¬\n...",
    "html": "<div class=\"content\">...</div>"
  },
  "attachments": [
    {
      "name": "è£è™•æ›¸",
      "url": "https://www.fsc.gov.tw/...",
      "type": "pdf",
      "local_path": "data/attachments/penalties/fsc_pen_20250925_0001/attachment_1.pdf",
      "size_bytes": 123456,
      "downloaded": true
    }
  ],
  "metadata": {
    "doc_number": "é‡‘ç®¡ä¿å£½å­—ç¬¬11404937382è™Ÿ",
    "penalized_entity": {
      "name": "å…¨çƒäººå£½ä¿éšªè‚¡ä»½æœ‰é™å…¬å¸",
      "type": "insurance",
      "tax_id": "ç•¥"
    },
    "penalty_amount": 3000000,
    "penalty_amount_text": "æ–°è‡ºå¹£300è¬å…ƒ",
    "violation": {
      "summary": "å…§æ§ç¨‹åºç¼ºå¤±",
      "details": "æœªå°±è‘£äº‹å‡ºå·®è¨‚å®šæ‡‰äº‹å…ˆå°±å‡ºå·®ç›®çš„ã€è¡Œç¨‹åŠèˆ‡æ¥­å‹™é—œè¯æ€§é€²è¡Œç”³è«‹åŠæ ¸å‡†ä¹‹ç›¸é—œå…§æ§ç¨‹åº..."
    },
    "legal_basis": [
      "ä¿éšªæ³•ç¬¬171æ¢ä¹‹1ç¬¬4é …",
      "ä¿éšªæ³•ç¬¬148æ¢ä¹‹3ç¬¬1é …",
      "ä¿éšªæ¥­å…§éƒ¨æ§åˆ¶åŠç¨½æ ¸åˆ¶åº¦å¯¦æ–½è¾¦æ³•ç¬¬5æ¢"
    ],
    "inspection_report": "112I018",
    "source": "insurance_bureau",
    "category": "internal_control_violation"
  }
}
```

### 2. ID ç”Ÿæˆè¦å‰‡

```python
def generate_penalty_id(date: str, index: int) -> str:
    """
    ç”Ÿæˆè£ç½°æ¡ˆä»¶ ID

    Args:
        date: æ—¥æœŸå­—ä¸² (YYYY-MM-DD)
        index: ç•¶æ—¥ç´¢å¼• (1-based)

    Returns:
        æ ¼å¼: fsc_pen_YYYYMMDD_NNNN

    ç¯„ä¾‹:
        fsc_pen_20250925_0001
        fsc_pen_20250811_0001
    """
    date_str = date.replace('-', '')
    return f"fsc_pen_{date_str}_{index:04d}"
```

### 3. Metadata æ¬„ä½èªªæ˜

| æ¬„ä½ | é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|------|
| `doc_number` | string | ç™¼æ–‡å­—è™Ÿ | "é‡‘ç®¡ä¿å£½å­—ç¬¬11404937382è™Ÿ" |
| `penalized_entity` | object | è¢«è™•åˆ†äººè³‡è¨Š | |
| `penalized_entity.name` | string | å…¬å¸/å€‹äººåç¨± | "å…¨çƒäººå£½ä¿éšªè‚¡ä»½æœ‰é™å…¬å¸" |
| `penalized_entity.type` | string | æ¥­åˆ¥é¡å‹ | "insurance", "bank", "securities" |
| `penalized_entity.tax_id` | string | çµ±ä¸€ç·¨è™Ÿï¼ˆå¯èƒ½ç•¥ï¼‰ | "12345678" æˆ– "ç•¥" |
| `penalty_amount` | integer | ç½°é°é‡‘é¡ï¼ˆæ•¸å€¼ï¼‰ | 3000000 |
| `penalty_amount_text` | string | ç½°é°é‡‘é¡ï¼ˆåŸæ–‡ï¼‰ | "æ–°è‡ºå¹£300è¬å…ƒ" |
| `violation.summary` | string | é•è¦äº‹é …æ‘˜è¦ | "å…§æ§ç¨‹åºç¼ºå¤±" |
| `violation.details` | string | é•è¦äº‹å¯¦è©³æƒ… | "æœªå°±è‘£äº‹å‡ºå·®è¨‚å®š..." |
| `legal_basis` | array | æ³•æ¢ä¾æ“š | ["ä¿éšªæ³•ç¬¬171æ¢ä¹‹1ç¬¬4é …", ...] |
| `inspection_report` | string | æª¢æŸ¥å ±å‘Šç·¨è™Ÿï¼ˆå¦‚æœ‰ï¼‰ | "112I018" |
| `source` | string | æ¨™æº–åŒ–ä¾†æº | "insurance_bureau", "bank_bureau" |
| `category` | string | é•è¦é¡å‹ | è¦‹ä¸‹è¡¨ |

### 4. é•è¦é¡å‹åˆ†é¡

```yaml
penalty_categories:
  "å…§æ§": "internal_control_violation"
  "æ³•ä»¤éµå¾ª": "compliance_violation"
  "è³‡æœ¬é©è¶³": "capital_adequacy"
  "æ´—éŒ¢é˜²åˆ¶": "aml_violation"
  "è³‡è¨Šå®‰å…¨": "information_security"
  "æ¥­å‹™æ‹›æ”¬": "business_solicitation"
  "ä¿éšªé‡‘çµ¦ä»˜": "claim_payment"
  "å®¢æˆ¶ä¿è­·": "customer_protection"
  "è©æ¬º": "fraud"
  "å…§ç·šäº¤æ˜“": "insider_trading"
  "å…¶ä»–": "other"
```

---

## ğŸ“ Markdown æ ¼å¼åŒ–è¨­è¨ˆ

### Gemini File Search æ ¼å¼

```markdown
# å…¨çƒäººå£½ä¿éšªè‚¡ä»½æœ‰é™å…¬å¸ - å…§æ§ç¨‹åºç¼ºå¤±è£ç½°æ¡ˆä»¶

**è³‡æ–™é¡å‹**: è£ç½°æ¡ˆä»¶
**æ–‡ä»¶ ID**: fsc_pen_20250925_0001
**ç™¼æ–‡æ—¥æœŸ**: 2025-09-25
**ç™¼æ–‡å­—è™Ÿ**: é‡‘ç®¡ä¿å£½å­—ç¬¬11404937382è™Ÿ
**è³‡æ–™ä¾†æº**: ä¿éšªå±€

---

## è¢«è™•åˆ†äºº

**åç¨±**: å…¨çƒäººå£½ä¿éšªè‚¡ä»½æœ‰é™å…¬å¸
**çµ±ä¸€ç·¨è™Ÿ**: ç•¥
**æ¥­åˆ¥**: ä¿éšªæ¥­

---

## è™•åˆ†å…§å®¹

**ç½°é°é‡‘é¡**: æ–°è‡ºå¹£300è¬å…ƒ
**è™•åˆ†ä¾æ“š**: ä¿éšªæ³•ç¬¬171æ¢ä¹‹1ç¬¬4é …

---

## é•è¦äº‹å¯¦

### æª¢æŸ¥å ±å‘Šç·¨è™Ÿ
112I018

### é•è¦äº‹é …æ‘˜è¦
å…§æ§ç¨‹åºç¼ºå¤±

### é•è¦äº‹å¯¦è©³æƒ…

è²´å…¬å¸é›–è¨‚æœ‰ã€Œè‘£äº‹å·®æ—…è²»ç”³å ±ä½œæ¥­è¾¦æ³•ã€æ“šä»¥æ ¸éŠ·è‘£äº‹å·®æ—…è²»ç”¨ï¼ŒæƒŸæœªå°±è‘£äº‹å‡ºå·®è¨‚å®šæ‡‰äº‹å…ˆå°±å‡ºå·®ç›®çš„ã€è¡Œç¨‹åŠèˆ‡æ¥­å‹™é—œè¯æ€§é€²è¡Œç”³è«‹åŠæ ¸å‡†ä¹‹ç›¸é—œå…§æ§ç¨‹åºï¼Œä¸åˆ©ç¢ºèªåƒè¨ªä¹‹å¿…è¦æ€§ã€åˆç†æ€§ï¼Œä»¥åŠè‘£äº‹å‡ºå·®èˆ‡æ¥­å‹™ä¹‹é—œè¯æ€§ã€‚

å¦‚:æ™‚ä»»è‘£äº‹é•·åŠå‰¯è‘£äº‹é•·æ–¼110å¹´è‡³111å¹´é–“èµ´åœ‹å¤–é€²è¡Œä¸å‹•ç”¢è€ƒå¯Ÿå…±è¨ˆ7æ¬¡ï¼Œç¶“æŸ¥æ¸ ç­‰ç”³è«‹æ ¸éŠ·å‡ºå·®ç¶“è²»æ™‚...

---

## æ³•æ¢ä¾æ“š

1. ä¿éšªæ³•ç¬¬148æ¢ä¹‹3ç¬¬1é …
2. ä¿éšªæ¥­å…§éƒ¨æ§åˆ¶åŠç¨½æ ¸åˆ¶åº¦å¯¦æ–½è¾¦æ³•ç¬¬5æ¢
3. ä¿éšªæ³•ç¬¬171æ¢ä¹‹1ç¬¬4é …

---

## åŸæ–‡é€£çµ

[æŸ¥çœ‹å®Œæ•´è£è™•æ›¸](https://www.fsc.gov.tw/ch/home.jsp?id=131&parentpath=0,2&mcustomize=multimessage_view.jsp&dataserno=202509300001&dtable=Penalty)

---

## ğŸ“ é™„ä»¶

1. [è£è™•æ›¸ PDF](é™„ä»¶é€£çµ)

---

*æœ¬æ–‡ä»¶ç‚ºé‡‘èç›£ç£ç®¡ç†å§”å“¡æœƒè£ç½°æ¡ˆä»¶ï¼Œå…§å®¹æ‘˜éŒ„è‡ªå®˜æ–¹è£è™•æ›¸ã€‚*
```

---

## ğŸ” èˆ‡å…¬å‘Šçš„å·®ç•°

| é …ç›® | å…¬å‘Š (Announcements) | è£ç½°æ¡ˆä»¶ (Penalties) |
|------|---------------------|---------------------|
| **è³‡æ–™é¡å‹** | `announcement` | `penalty` |
| **ID å‰ç¶´** | `fsc_ann_` | `fsc_pen_` |
| **ä¸»è¦å…§å®¹** | æ³•è¦ä¿®æ­£ã€æ”¿ç­–å®£å° | è£ç½°è™•åˆ†ã€é•è¦äº‹å¯¦ |
| **çµæ§‹åŒ–ç¨‹åº¦** | ä¸­ç­‰ï¼ˆä¿®æ­£èªªæ˜ï¼‰ | é«˜ï¼ˆè£è™•æ›¸æ ¼å¼ï¼‰ |
| **é—œéµæ¬„ä½** | ä¿®æ­£æ¢æ–‡ã€å°ç…§è¡¨ | è™•åˆ†é‡‘é¡ã€æ³•æ¢ã€é•è¦äº‹å¯¦ |
| **æ™‚æ•ˆæ€§æ„ç¾©** | æ–°æ³•å–ä»£èˆŠæ³• | ç¨ç«‹æ¡ˆä»¶ï¼Œç„¡å–ä»£é—œä¿‚ |
| **æŸ¥è©¢éœ€æ±‚** | "æœ€æ–°è¦å®šæ˜¯ä»€éº¼" | "æŸå…¬å¸æœ‰ç„¡è¢«ç½°" |
| **é™„ä»¶é‡è¦æ€§** | å°ç…§è¡¨æ¥µé‡è¦ | è£è™•æ›¸é‡è¦ |

---

## ğŸ¯ Gemini Store è¨­è¨ˆ

### æ–¹æ¡ˆï¼šç¨ç«‹ Store

**å»ºè­°**ï¼šå…¬å‘Šå’Œè£ç½°æ¡ˆä»¶ä½¿ç”¨**ä¸åŒçš„ Store**

#### ç†ç”±

1. **æŸ¥è©¢å ´æ™¯ä¸åŒ**ï¼š
   - å…¬å‘Šï¼šæŸ¥è©¢æ³•è¦è¦å®šã€æ¢æ–‡ä¿®æ­£
   - è£ç½°ï¼šæŸ¥è©¢é•è¦æ¡ˆä¾‹ã€è™•åˆ†å…ˆä¾‹

2. **æ–‡ä»¶æ€§è³ªä¸åŒ**ï¼š
   - å…¬å‘Šï¼šè¦ç¯„æ€§æ–‡ä»¶ï¼ˆæœ‰æ™‚æ•ˆæ€§ã€å–ä»£é—œä¿‚ï¼‰
   - è£ç½°ï¼šäº‹å¯¦æ€§æ–‡ä»¶ï¼ˆæ­·å²è¨˜éŒ„ã€ç„¡å–ä»£é—œä¿‚ï¼‰

3. **æª¢ç´¢é‚è¼¯ä¸åŒ**ï¼š
   - å…¬å‘Šï¼šéœ€è¦æ™‚æ•ˆæ€§æ’åºï¼ˆæ–°å„ªå…ˆï¼‰
   - è£ç½°ï¼šéœ€è¦ç›¸é—œæ€§æœå°‹ï¼ˆæ‰¾é¡ä¼¼æ¡ˆä¾‹ï¼‰

4. **ç”¨æˆ¶éœ€æ±‚**ï¼š
   - å¯å–®ç¨æŸ¥è©¢å…¬å‘Šæˆ–è£ç½°
   - å¯åŒæ™‚æŸ¥è©¢å…©è€…ï¼ˆå¤š Store æŸ¥è©¢ï¼‰

#### Store é…ç½®

```python
# Store 1: å…¬å‘Š
store_name = 'fsc-announcements'
file_count = ~7,500
avg_file_size = 5 KB
total_size = ~40 MB

# Store 2: è£ç½°æ¡ˆä»¶
store_name = 'fsc-penalties'
file_count = ~630
avg_file_size = 3 KB
total_size = ~2 MB

# å¤š Store æŸ¥è©¢ç¯„ä¾‹
tools = [
    types.Tool(
        fileSearch=types.FileSearch(
            fileSearchStoreNames=['fsc-announcements', 'fsc-penalties']
        )
    )
]
```

---

## ğŸ“Š æŸ¥è©¢å ´æ™¯è¨­è¨ˆ

### å ´æ™¯ 1ï¼šåªæŸ¥å…¬å‘Š

```python
# ä½¿ç”¨è€…ï¼šã€Œå¹´å ±è¨˜è¼‰äº‹é …æœ‰ä»€éº¼æ–°è¦å®šï¼Ÿã€
tools = [
    types.Tool(
        fileSearch=types.FileSearch(
            fileSearchStoreNames=['fsc-announcements']
        )
    )
]
```

### å ´æ™¯ 2ï¼šåªæŸ¥è£ç½°

```python
# ä½¿ç”¨è€…ï¼šã€Œå…¨çƒäººå£½æœ€è¿‘æœ‰è¢«ç½°å—ï¼Ÿã€
tools = [
    types.Tool(
        fileSearch=types.FileSearch(
            fileSearchStoreNames=['fsc-penalties']
        )
    )
]
```

### å ´æ™¯ 3ï¼šåŒæ™‚æŸ¥è©¢

```python
# ä½¿ç”¨è€…ï¼šã€Œå…§æ§ç¨‹åºæœ‰å“ªäº›è¦å®šï¼Ÿæœ‰å“ªäº›å…¬å¸é•åï¼Ÿã€
tools = [
    types.Tool(
        fileSearch=types.FileSearch(
            fileSearchStoreNames=['fsc-announcements', 'fsc-penalties']
        )
    )
]
```

---

## ğŸ”§ å¯¦ä½œä»»å‹™

### 1. æ›´æ–° `config/sources.yaml`

```yaml
penalties:
  enabled: true
  display_name: "è£ç½°æ¡ˆä»¶"
  base_url: "https://www.fsc.gov.tw/ch/home.jsp"
  list_page_id: 131
  parent_path: "0,2"
  total_pages: 42
  per_page: 15
```

### 2. å»ºç«‹ `src/crawlers/penalties.py`

ç¹¼æ‰¿ `BaseFSCCrawler`ï¼Œå¯¦ä½œï¼š
- `get_list_url(page)`: è¿”å›åˆ—è¡¨ URL
- `parse_list_page(html)`: è§£æåˆ—è¡¨ï¼ˆèˆ‡å…¬å‘Šç›¸åŒï¼‰
- `parse_detail_page(html, list_item)`: è§£æè©³ç´°é ï¼Œæå–çµæ§‹åŒ–è³‡æ–™

### 3. å»ºç«‹è¼”åŠ©å‡½æ•¸

```python
# src/utils/helpers.py

def extract_penalty_amount(text: str) -> tuple[int, str]:
    """æå–è™•åˆ†é‡‘é¡"""
    # æ­£å‰‡: æ–°è‡ºå¹£(\d+)è¬å…ƒ
    # è¿”å›: (3000000, "æ–°è‡ºå¹£300è¬å…ƒ")
    pass

def extract_legal_basis(text: str) -> list[str]:
    """æå–æ³•æ¢ä¾æ“š"""
    # æ­£å‰‡: .*æ³•ç¬¬\d+æ¢.*
    # è¿”å›: ["ä¿éšªæ³•ç¬¬171æ¢ä¹‹1ç¬¬4é …", ...]
    pass

def detect_penalty_category(title: str, content: str, mapping: dict) -> str:
    """åµæ¸¬é•è¦é¡å‹"""
    pass
```

### 4. æ¸¬è©¦è…³æœ¬

```bash
# scripts/test_penalty_crawler.py
python scripts/test_penalty_crawler.py  # çˆ¬å–å‰ 3 é 
```

### 5. ä¸Šå‚³åˆ° Gemini

```python
from src.uploader.gemini_uploader import GeminiUploader

uploader = GeminiUploader(
    api_key='...',
    store_name='fsc-penalties'  # ç¨ç«‹ Store
)

# ä¸Šå‚³è£ç½°æ¡ˆä»¶ Markdown
uploader.upload_directory('data/penalties_markdown/individual')
```

---

## ğŸ“… æ™‚æ•ˆæ€§è™•ç†å·®ç•°

### å…¬å‘Šï¼ˆæœ‰æ™‚æ•ˆæ€§ï¼‰

- **ç‰¹æ€§**ï¼šæ–°æ–‡ä»¶å–ä»£èˆŠæ–‡ä»¶
- **è™•ç†**ï¼šMarkdown æ¨™è¨» "â­ æœ€æ–°ç‰ˆæœ¬" æˆ– "âš ï¸ å·²å»¢æ­¢"
- **Prompt**ï¼šå¼·èª¿ã€Œä½¿ç”¨æœ€æ–°æ—¥æœŸçš„æ–‡ä»¶ã€

### è£ç½°æ¡ˆä»¶ï¼ˆç„¡æ™‚æ•ˆæ€§ï¼‰

- **ç‰¹æ€§**ï¼šæ¯å€‹æ¡ˆä»¶ç¨ç«‹ï¼Œç„¡å–ä»£é—œä¿‚
- **è™•ç†**ï¼šä¸éœ€ç‰¹æ®Šæ¨™è¨»
- **Prompt**ï¼šæŒ‰ç›¸é—œæ€§æª¢ç´¢å³å¯

---

## âœ… æª¢æŸ¥æ¸…å–®

å¯¦ä½œè£ç½°æ¡ˆä»¶çˆ¬èŸ²å‰çš„æª¢æŸ¥ï¼š

- [x] æ¢ç´¢ç¶²ç«™çµæ§‹
- [x] è¨­è¨ˆ JSONL è³‡æ–™æ ¼å¼
- [x] è¨­è¨ˆ Metadata æ¬„ä½
- [x] è¨­è¨ˆ Markdown æ ¼å¼
- [x] è¦åŠƒ Gemini Store æ¶æ§‹
- [ ] æ›´æ–° `config/sources.yaml`
- [ ] å¯¦ä½œ `PenaltyCrawler`
- [ ] å¯¦ä½œè¼”åŠ©å‡½æ•¸
- [ ] æ¸¬è©¦çˆ¬èŸ²
- [ ] æ¸¬è©¦ä¸Šå‚³
- [ ] æ•´åˆæŸ¥è©¢æ¸¬è©¦

---

**ä¸‹ä¸€æ­¥**ï¼šå¯¦ä½œ `src/crawlers/penalties.py`
